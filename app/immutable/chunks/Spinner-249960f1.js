var V=Object.defineProperty,W=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var T=(e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,D=(e,t)=>{for(var r in t||(t={}))$.call(t,r)&&T(e,r,t[r]);if(q)for(var r of q(t))B.call(t,r)&&T(e,r,t[r]);return e},P=(e,t)=>W(e,G(t));import{a6 as J,S as K,i as M,s as Q,e as S,k,c as y,a as A,d as x,m as E,b as w,f as g,T as X,I as F,g as Y,J as b,E as O}from"./index-ba485866.js";import{w as L,d as N}from"./singletons-a1a1a8c2.js";const Z=()=>{const e=J("__svelte__");return{page:{subscribe:e.page.subscribe},navigating:{subscribe:e.navigating.subscribe},get preloading(){return console.error("stores.preloading is deprecated; use stores.navigating instead"),{subscribe:e.navigating.subscribe}},session:e.session,updated:e.updated}},Se={subscribe(e){return Z().page.subscribe(e)}},U={baseUrl:"https://:lang.wikipedia.org/w/api.php",defaultParams:{format:"json",action:"query",generator:"search",gsrnamespace:0,gsrlimit:10,prop:"pageimages|extracts|pageterms|info|pageprops",pilimit:"max",exintro:1,explaintext:1,exsentences:2,exlimit:"max",origin:"*",pithumbsize:500}},ee={summaryUrl:"https://:lang.wikipedia.org/api/rest_v1/page/summary/:page?origin=*",timeout:1e4},j={pageviewsUrl:"https://wikimedia.org/api/rest_v1/metrics/pageviews/top/:lang.wikipedia.org/all-access/:date",maxRetries:10,retryBackoff:1e3,maxArticles:50},te=["Wikipedia:Portada","Main_Page","Special:Search","Wikip\xE9dia:P\xE1gina_principal","Especial:Pesquisar","Wikipedia:Featured_pictures","Wikip\xE9dia:Accueil_principal","Portal:Current_events","Wikipedia:Hauptseite","Pagina_principale","Help:IPA/English","CEO","Video_hosting_service","F5_Networks","File:","Ficheiro:","Help","Ajuda"],R="en";function re(e,t=400){if(!e||!e.includes("px-"))return e;try{const r=e.split("/"),d=r.pop(),a=d.indexOf("px");if(a===-1)return e;const i=`${t}px${d.slice(a+2)}`;return[...r,i].join("/")}catch(r){return console.warn(`Failed to normalize image URL: ${e}`,r),e}}function ae(e){return!!(!e||e.error===!0||e.title&&e.title.toLowerCase().includes("not found"))}function se(e){return e&&(e.extract||e.description)||""}function ie(e){return!e||typeof e!="string"?"":e.replace(/<[^>]*>/g,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").trim()}function ne(e){var t,r;return e?(r=(t=e.content_urls)==null?void 0:t.desktop)!=null&&r.page?e.content_urls.desktop.page:e.canonicalurl?e.canonicalurl:"/":"/"}function oe(e){return Object.entries(e).filter(([,t])=>t!=null&&t!=="").map(([t,r])=>`${encodeURIComponent(t)}=${encodeURIComponent(r)}`).join("&")}function le(e="en"){let t=e,r=null;const d=a=>{const i=U.baseUrl.replace(":lang",t),l=oe(D({gsrsearch:a},U.defaultParams));return`${i}?${l}`};return{getLanguage:()=>t,setLanguage:a=>{t=a},buildSearchUrl:d,search:async a=>{if(!a||a.trim()==="")throw new Error("Search term cannot be empty");const i=d(a);r=i;try{const l=await fetch(i);if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);return await l.json()}catch(l){throw console.error("Search API error:",l),l}},getLastSearchUrl:()=>r,updateSearchUrlLanguage:a=>{if(!r)return null;const i=U.baseUrl.replace(":lang",a),l=U.baseUrl.replace(":lang",t);return r=r.replace(i,l),r}}}const ce="wiki_featured_";function z(){try{const e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}function H(e,t){if(!e||!t)throw new Error("Language and date are required for cache key");const r=t.toISOString().split("T")[0];return`${ce}${e}:${r}`}function ue(e,t){if(!z())return null;try{const r=H(e,t),d=localStorage.getItem(r);if(!d)return null;const a=JSON.parse(d);return Array.isArray(a)?a:(console.warn(`Invalid cache data format for ${r}, clearing...`),localStorage.removeItem(r),null)}catch(r){return console.warn(`Error reading cache for ${e}:${t.toISOString().split("T")[0]}:`,r),null}}function ge(e,t,r){if(!z())return!1;if(!Array.isArray(r))return console.warn("Cannot cache non-array articles data"),!1;try{const d=H(e,t),a=JSON.stringify(r);return localStorage.setItem(d,a),!0}catch(d){return d.name==="QuotaExceededError"||d.code===22?console.warn("localStorage quota exceeded, cannot cache articles"):console.warn(`Error storing cache for ${e}:${t.toISOString().split("T")[0]}:`,d),!1}}function de(e="en"){let t=e;function r(s){return s.toJSON().slice(0,10).replace(/-/g,"/")}function d(s){return j.pageviewsUrl.replace(":lang",t).replace(":date",r(s))}async function a(s){const o=ee.summaryUrl.replace(":lang",t).replace(":page",encodeURIComponent(s));try{const c=await fetch(o);return c.ok?await c.json():{error:!0,status:c.status}}catch(c){return{error:!0,message:c.message}}}async function i(s){var u;if(!s||!s.article||te.includes(s.article))return null;const o=await a(s.article);if(ae(o)||!o.title)return null;let c=null;return(u=o.thumbnail)!=null&&u.source&&(c=re(o.thumbnail.source,400)),{title:o.title,text:se(o),link:ne(o),image:c,views:s.views,tags:[s.views.toLocaleString()+" views"]}}const l=async s=>{if(!s.items||s.items.length===0)return[];const o=s.items[0].articles;return!o||o.length===0?[]:(await Promise.all(o.slice(0,j.maxArticles).map(u=>i(u)))).filter(u=>u!==null).map((u,v)=>P(D({},u),{rank:v+1,views_formatted:u.views.toLocaleString()}))};return{getLanguage:()=>t,setLanguage:s=>{t=s},fetchFeatured:async(s,o={})=>{const{onSuccess:c,onError:u}=o,v=ue(t,s);if(v&&v.length>0)return c&&c(v),{status:"success",data:v};const m=d(s);try{const p=await fetch(m);if(p.status===404)return u&&u(new Error("No data available for this date")),{status:"no_data",data:[]};if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);const h=await p.json(),_=await l(h);return _.length===0?(u&&u(new Error("No articles found")),{status:"no_data",data:[]}):(ge(t,s,_),c&&c(_),{status:"success",data:_})}catch(p){return console.error("Featured articles fetch error:",p),u&&u(p),{status:"error",data:[],message:p.message}}},parseFeatured:l}}function fe(){const e=L({}),t=L(!1);let r=le(R);return{results:N(e,a=>{let i=[];if(a&&a.query&&a.query.pages){let l=0;Object.entries(a.query.pages).forEach(s=>{var m,p,h;const[o,c]=s;if(!c||!c.title)return;const u=ie(c.extract)||((m=c.pageprops)==null?void 0:m["wikibase-shortdesc"])||"",v={i:l,title:c.title||"",text:u,tags:((p=c.terms)==null?void 0:p.alias)&&Array.isArray(c.terms.alias)?c.terms.alias:[],link:c.canonicalurl||"/",image:((h=c.thumbnail)==null?void 0:h.source)||""};i.push(v),l++})}return i}),isLoading:t,search:async a=>{t.set(!0);try{const i=await r.search(a);e.set(i)}catch(i){console.error("Search failed:",i),e.set({error:!0,message:i.message})}finally{t.set(!1)}},setLanguage:async a=>{const i=r.getLanguage();if(r.setLanguage(a),r.getLastSearchUrl()){const s=r.updateSearchUrlLanguage(i);if(s)try{const o=await fetch(s);if(!o.ok)throw new Error(`HTTP ${o.status}`);const c=await o.json();e.set(c)}catch(o){console.error("Failed to refresh search with new language:",o)}}},clear:()=>{e.set({})},getLanguage:()=>r.getLanguage()}}function pe(){const e=L({status:"idle",data:null,requestedDate:null,message:null}),t=L(!1);let r=de(R);return{articles:N(e,a=>a.data&&Array.isArray(a.data)?a.data:[]),isLoading:t,fetchForDate:async a=>{t.set(!0),e.update(i=>P(D({},i),{status:"loading",requestedDate:a,data:null}));try{const i=await r.fetchFeatured(a);e.set({status:i.status,data:i.data,requestedDate:a,message:i.message||null})}catch(i){console.error("Failed to fetch featured articles:",i),e.set({status:"error",message:i.message,requestedDate:a,data:null})}finally{t.set(!1)}},setLanguage:a=>{r.setLanguage(a)},getLanguage:()=>r.getLanguage(),getRawStore:()=>e}}function he(){return L(!1)}const ye=fe(),xe=pe(),Ae=he();function me(e){let t,r,d,a,i,l,s,o,c,u,v,m,p,h,_,I,C;return{c(){t=S("div"),r=S("div"),d=k(),a=S("div"),i=k(),l=S("div"),s=k(),o=S("div"),c=k(),u=S("div"),v=k(),m=S("div"),p=k(),h=S("img"),this.h()},l(f){t=y(f,"DIV",{class:!0,style:!0});var n=A(t);r=y(n,"DIV",{class:!0,style:!0}),A(r).forEach(x),d=E(n),a=y(n,"DIV",{class:!0,style:!0}),A(a).forEach(x),i=E(n),l=y(n,"DIV",{class:!0,style:!0}),A(l).forEach(x),s=E(n),o=y(n,"DIV",{class:!0,style:!0}),A(o).forEach(x),c=E(n),u=y(n,"DIV",{class:!0,style:!0}),A(u).forEach(x),v=E(n),m=y(n,"DIV",{class:!0,style:!0}),A(m).forEach(x),p=E(n),h=y(n,"IMG",{alt:!0,width:!0,height:!0,src:!0}),n.forEach(x),this.h()},h(){w(r,"class","blue-orbit leo svelte-4sel8c"),g(r,"width",e[1].blue+"px"),g(r,"height",e[1].blue+"px"),w(a,"class","green-orbit leo svelte-4sel8c"),g(a,"width",e[1].green+"px"),g(a,"height",e[1].green+"px"),w(l,"class","red-orbit leo svelte-4sel8c"),g(l,"width",e[1].red+"px"),g(l,"height",e[1].red+"px"),w(o,"class","white-orbit w1 leo svelte-4sel8c"),g(o,"width",e[1].white+"px"),g(o,"height",e[1].white+"px"),w(u,"class","white-orbit w2 leo svelte-4sel8c"),g(u,"width",e[1].white+"px"),g(u,"height",e[1].white+"px"),w(m,"class","white-orbit w3 leo svelte-4sel8c"),g(m,"width",e[1].white+"px"),g(m,"height",e[1].white+"px"),w(h,"alt","logo"),w(h,"width",_=e[1].logo),w(h,"height",I=e[1].logo),X(h.src,C="https://upload.wikimedia.org/wikipedia/en/thumb/8/80/Wikipedia-logo-v2.svg/155px-Wikipedia-logo-v2.svg.png")||w(h,"src",C),w(t,"class","spinner-box svelte-4sel8c"),g(t,"width",e[1].box+"px"),g(t,"height",e[1].box+"px"),F(t,"absolute",e[0]),F(t,"positioned",e[0])},m(f,n){Y(f,t,n),b(t,r),b(t,d),b(t,a),b(t,i),b(t,l),b(t,s),b(t,o),b(t,c),b(t,u),b(t,v),b(t,m),b(t,p),b(t,h)},p(f,[n]){n&2&&g(r,"width",f[1].blue+"px"),n&2&&g(r,"height",f[1].blue+"px"),n&2&&g(a,"width",f[1].green+"px"),n&2&&g(a,"height",f[1].green+"px"),n&2&&g(l,"width",f[1].red+"px"),n&2&&g(l,"height",f[1].red+"px"),n&2&&g(o,"width",f[1].white+"px"),n&2&&g(o,"height",f[1].white+"px"),n&2&&g(u,"width",f[1].white+"px"),n&2&&g(u,"height",f[1].white+"px"),n&2&&g(m,"width",f[1].white+"px"),n&2&&g(m,"height",f[1].white+"px"),n&2&&_!==(_=f[1].logo)&&w(h,"width",_),n&2&&I!==(I=f[1].logo)&&w(h,"height",I),n&2&&g(t,"width",f[1].box+"px"),n&2&&g(t,"height",f[1].box+"px"),n&1&&F(t,"absolute",f[0]),n&1&&F(t,"positioned",f[0])},i:O,o:O,d(f){f&&x(t)}}}function we(e,t,r){let d,{size:a="md"}=t,{absolute:i=!1}=t;const l={sm:{box:75,blue:41,green:30,red:22,white:15,logo:10},md:{box:150,blue:82.5,green:60,red:45,white:30,logo:20},lg:{box:200,blue:110,green:80,red:60,white:40,logo:28}};return e.$$set=s=>{"size"in s&&r(2,a=s.size),"absolute"in s&&r(0,i=s.absolute)},e.$$.update=()=>{e.$$.dirty&4&&r(1,d=l[a]||l.md)},[i,d,a]}class ke extends K{constructor(t){super(),M(this,t,we,me,Q,{size:2,absolute:0})}}export{ke as S,xe as f,Ae as l,Se as p,ye as s};
