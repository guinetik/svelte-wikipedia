import{d as h,w as A}from"./index-732587ae.js";let g=A([]),u=A([]);Array.prototype.forEachAsyncParallel=async function(e){await Promise.all(this.map(e))};const t={language:"en",SEARCH_BASE_URL:"https://:lang.wikipedia.org/w/api.php",FEATURED_BASE_URL:"https://wikimedia.org/api/rest_v1/metrics/pageviews/top/:lang.wikipedia.org/all-access/:date",searchApiUrl:"",SEARCH_REQUEST_OPTIONS:{format:"json",action:"query",generator:"search",gsrnamespace:0,gsrlimit:10,prop:"pageimages|extracts|pageterms|images|info|extracts&inprop=url",pilimit:"max",exintro:"",explaintext:"",exsentences:1,exlimit:"max",origin:"*",pithumbsize:500},banned:["Wikipedia:Portada","Main_Page","Special:Search","Wikip\xE9dia:P\xE1gina_principal","Especial:Pesquisar","Wikipedia:Featured_pictures","Wikip\xE9dia:Accueil_principal","Portal:Current_events","Wikipedia:Hauptseite","Pagina_principale","Help:IPA/English","CEO","Video_hosting_service","F5_Networks","File:","Ficheiro:","Help","Ajuda"],searchResults:h(g,e=>{let l=[];if(console.log("new search results:",e),e.query){let i=0;Object.entries(e.query.pages).forEach(r=>{const[c,a]=r,n={i,title:a.title,text:a.extract?a.extract:"",tags:a.terms.alias?a.terms.alias:[],link:a.canonicalurl,image:a.thumbnail?a.thumbnail.source:""};l.push(n),i++})}return l}),featuredArticles:h(u,e=>e),search:e=>{console.log("searching for ",e),t.searchApiUrl=t.getSearchApiUrl(e),t.fetch(t.searchApiUrl,g)},getFeaturedPosts:async()=>{let e=new Date;e.setDate(e.getDate()-1),e.setHours(0);let l=t.FEATURED_BASE_URL.replaceAll(":lang",t.language).replaceAll(":date",e.toJSON().slice(0,10).replaceAll("-","/"));u.set([]),fetch(l).then(i=>i.json()).then(async i=>{const r=[];if(i.items&&i.items.length>0){const c=i.items[0].articles;if(c){let a=1;await c.filter(n=>!t.banned.includes(n.article)).slice(0,50).forEachAsyncParallel(async n=>{const s=await t.getPageDetails(n.article);if(!s.title.toLowerCase().includes("not found")){let p=s.thumbnail?s.thumbnail.source:null;if(p&&p.includes("px-")){const o=p;p=o.split("/").splice(0,o.split("/").length-1).join("/")+"/400px"+o.split("/").pop().slice(o.split("/").pop().indexOf("px")+2)}let d={i:a,title:s.title,tags:["{} views".replace("{}",n.views.toLocaleString())],link:s.content_urls?s.content_urls.desktop.page:"/",image:p,views:n.views,text:s.extract||s.description};r.push(d)}a++})}}u.set(r)}).catch(i=>(console.log(i),[]))},getPageDetails:async e=>{let l="https://:lang.wikipedia.org/api/rest_v1/page/summary/:page?origin=*".replaceAll(":lang",t.language).replaceAll(":page",e);return await(await fetch(l)).json()},fetch:(e,l)=>{console.log("fecthing from:",e),fetch(e).then(i=>i.json()).then(i=>{l.set(i)}).catch(i=>(console.log(i),[]))},getSearchApiUrl:e=>{const l="?gsrsearch="+e+Object.entries(t.SEARCH_REQUEST_OPTIONS).reduce((i,r)=>{const[c,a]=r;return i+"&"+c+"="+a},"");return t.getApiBaseURL()+l},getApiBaseURL:()=>(console.log("language",t.language),t.SEARCH_BASE_URL.replaceAll(":lang",t.language)),setLanguage:e=>{const l=t.getApiBaseURL();t.language=e;const i=t.getApiBaseURL();t.searchApiUrl&&(t.searchApiUrl=t.searchApiUrl.replaceAll(l,i),t.fetch(t.searchApiUrl,g)),t.getFeaturedPosts()}};export{t as W};
